# 1.开发环境

## 1.1.系统约定

本项目开发完成后，需要基于镜像文件 `ubuntu:20.04, nginx` 开发以下镜像文件：

- `limou3434/intelligent-interview-frontend-in-ubuntu:latest` 内部需要有基础的系统工具和系统服务，以及存储项目的源代码和可执行可部署文件，方便后期一键部署（内部允许存在一个本地数据库交给程序员进行容器测试）

## 1.2.软件约定

直接查阅 `package.json` 文档即可，或者使用命令行导出。

# 2.功能模块

根据之前的需求分析，这里列出我们要实现的功能，并且

对下列任务进行优先级标记，其中：

*   `P0` 为必做核心
*   `P1` 为重点功能
*   `P2` 为实用功能
*   `P3` 可做可不做

## 2.1.基础功能开发模块

*   用户模块 `P0`
    *   **普通用户** 注册和登录
    *   **管理员用户** 管理普通用户（增删改查）
*   题库模块 `P0`
    *   **普通用户** 查看题库列表
    *   **普通用户** 查看题库详情（展示题库下的题目）
    *   **管理员用户** 管理题库（增删改查）
*   题目模块 `P0`
    *   **普通用户** 搜索题目
    *   **普通用户** 查看题目详情（进入刷题页面）
    *   **管理员用户** 管理题目（增删改查）

## 2.2.高级功能开发模块

*   题目批量管理 `P1`
*   分词题目搜索 `P1`
*   用户刷题记录日历图 `P2`
*   自动缓存热门题目 `P2`
*   网站流量控制和熔断 `P2`
*   动态 `IP` 黑白名单过滤 `P2`
*   同端登录冲突检测 `P2`
*   分级题目反爬虫策略 `P2`
*   被删除记录的冷存策略和备份回溯机制 `P3`
*   会员机制 `P3`

# 3.前端设计

## 3.1.接口设计

通过需求分析和模块分析，给出的 [接口文档](./005_limou_2024_10_24_智能面试_接口开发文档.md)，由后端编写人员进行转化和编码。前端工作人员仅需要通过该接口文档进行开发即可，接口可以简单使用硬编码的 `Node.js` 服务程序进行配置。

## 3.2.界面设计

使用 `antd` 组件库，[官方文档中有关于 antd 组件在 Next.js 项目中应用](https://ant.design/docs/react/use-with-next-cn)，这个组件是有一些客户端渲染代码的，而 `Next.js` 是服务端渲染框架，因此如果不依照官方文档很容易出现依赖冲突。其中，[组件采用官方组件文档进行开发](https://ant.design/components/overview-cn/)。

- 基础页面开发

  - 用户凭证页面
  - 所有e管理页面（用户、题库、题目）

  - 按照题库查询题目
  - 修改题目所属题库

- 核心页面开发

  - 网站主页面
  - 题库列表页
  - 题目搜索页
  - 题库详情页
  - 题目详情页

# 4.项目初始

## 4.1.构建前端开发项目

使用 `npx create-next-app@14.2.6` 运行远端 `npm` 包初始化前端项目，配置过程如下。

```shell
# 构建前端项目
$ npx create-next-app@14.2.6
Need to install the following packages:
  create-next-app@14.2.6
Ok to proceed? (y) y
✔ What is your project named? … intelligent-interview-frontend
✔ Would you like to use TypeScript? … No / Yes
✔ Would you like to use ESLint? … No / Yes
✔ Would you like to use Tailwind CSS? … No / Yes
✔ Would you like to use `src/` directory? … No / Yes
✔ Would you like to use App Router? (recommended) … No / Yes
✔ Would you like to customize the default import alias (@/*)? … No / Yes
Creating a new Next.js app in /home/ljp/intelligent-interview-frontend.

Using npm.

Initializing project with template: app 


Installing dependencies:
- react
- react-dom
- next

Installing devDependencies:
- typescript
- @types/node
- @types/react
- @types/react-dom
- eslint
- eslint-config-next
# ...
# 运行 json 中的 "dev": "next dev" 即可

```

访问 `http://localhost:3000` 即可得到官方脚手架生成的页面。

## 4.2.安装前端所需组件

```shell
# 安装前端组件
$ npm install --save-dev eslint-config-prettier # 整合
$ npm install --save-dev --save-exact prettier # 安装
$ vim .eslintrc.json && cat .eslintrc.json # 修改配置
{
  "extends": ["next/core-web-vitals", "prettier"]
}

$ npm install antd --save # 安装 antd
$ npm install @ant-design/nextjs-registry --save # 安装关于 antd 支持 App Router 的优化
$ npm install axios
$ npm install ts-node --save-dev
$ npm i --save-dev @umijs/openapi
$ npm install @reduxjs/toolkit react-redux
$ npm i @bytemd/react
$ npm i @bytemd/plugin-highlight @bytemd/plugin-gfm
$ npm install github-markdown-css
 npm i @ant-design/pro-form
 
```

并且需要手动设置 `prettier`。

![image-20241030173046347](./assets/image-20241030173046347.png)

```shell
# .eslintrc.json: 配置插件
{
  "extends": ["next/core-web-vitals", "prettier"]
}

```

## 4.3.清空框架前端样式

```tsx
// src/app/layout.tsx: 无论访问哪一个页面都需要访问这个全局布局页面
// import type { Metadata } from "next";
// import { Inter } from "next/font/google";
import "./globals.css";
import { AntdRegistry } from "@ant-design/nextjs-registry";

// 国际化(暂时不用)
// const inter = Inter({ subsets: ["latin"] });

// 表示网页的标题描述(暂时不用)
// export const metadata: Metadata = {
//   title: "Create Next App",
//   description: "Generated by create next app",
// };

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    // <html lang="en">
    //   <body className={inter.className}>{children}</body>
    // </html>
    <html lang="en">
      <body>
        <AntdRegistry>{children}</AntdRegistry>
      </body>
    </html>
  );
}

```

上面的样式会影响到下面的主页页面。

```tsx
// src/app/page.tsx: 默认的主页页面
import Image from "next/image";
import styles from "./page.css";

export default function Home() {
  return (
    <main className={styles.main}>
      <div className={styles.description}>
        <p>
          Get started by editing&nbsp;
          <code className={styles.code}>src/app/page.tsx</code>
        </p>
        <div>
          <a
            href="https://vercel.com?utm_source=create-next-app&utm_medium=appdir-template&utm_campaign=create-next-app"
            target="_blank"
            rel="noopener noreferrer"
          >
            By{" "}
            <Image
              src="/vercel.svg"
              alt="Vercel Logo"
              className={styles.vercelLogo}
              width={100}
              height={24}
              priority
            />
          </a>
        </div>
      </div>

      <div className={styles.center}>
        <Image
          className={styles.logo}
          src="/next.svg"
          alt="Next.js Logo"
          width={180}
          height={37}
          priority
        />
      </div>

      <div className={styles.grid}>
        <a
          href="https://nextjs.org/docs?utm_source=create-next-app&utm_medium=appdir-template&utm_campaign=create-next-app"
          className={styles.card}
          target="_blank"
          rel="noopener noreferrer"
        >
          <h2>
            Docs <span>-&gt;</span>
          </h2>
          <p>Find in-depth information about Next.js features and API.</p>
        </a>

        <a
          href="https://nextjs.org/learn?utm_source=create-next-app&utm_medium=appdir-template&utm_campaign=create-next-app"
          className={styles.card}
          target="_blank"
          rel="noopener noreferrer"
        >
          <h2>
            Learn <span>-&gt;</span>
          </h2>
          <p>Learn about Next.js in an interactive course with&nbsp;quizzes!</p>
        </a>

        <a
          href="https://vercel.com/templates?framework=next.js&utm_source=create-next-app&utm_medium=appdir-template&utm_campaign=create-next-app"
          className={styles.card}
          target="_blank"
          rel="noopener noreferrer"
        >
          <h2>
            Templates <span>-&gt;</span>
          </h2>
          <p>Explore starter templates for Next.js.</p>
        </a>

        <a
          href="https://vercel.com/new?utm_source=create-next-app&utm_medium=appdir-template&utm_campaign=create-next-app"
          className={styles.card}
          target="_blank"
          rel="noopener noreferrer"
        >
          <h2>
            Deploy <span>-&gt;</span>
          </h2>
          <p>
            Instantly deploy your Next.js site to a shareable URL with Vercel.
          </p>
        </a>
      </div>
    </main>
  );
}

```

## 4.4.明确约定模式路由

`Next.js` 采用 **约定式路由**（而非 **配置性路由**），根据文件夹的结构和名称，可以自动将对应的 `URL` 地址映射到页面文件，但目录下必须带有 `page.js/jsx/ts/tsx` 文件才能支持。

```shell
# 理解前端路由
$ tree -L 2 -a app/
.
├── src/ # 默认存放项目代码的目录  
│     ├── components/ # 公共复用组件
│     └── app/ # 前端应用组件
│          ├── dashboard/
│          │     ├── components/ # 私有复用组件
│          │     ├── page.js # => '/dashboard'
│          │     ├── setting/
│          │     │     ├── components/ # 私有复用组件
│          │     │     ├── page.css
│          │     │     └── page.tsx # => '/dashboard/setting'
│          │     ├── (blog)/
│          │     │     ├── limou/
│          │     │     │     ├── components/ # 私有复用组件
│          │     │     │     ├── page.css
│          │     │     │     └── page.tsx # => '/dashboard/limou'
│          │     │     ├── dimou/
│          │     │     │     ├── components/ # 私有复用组件
│          │     │     │     ├── page.css
│          │     │     │     └── page.tsx # => '/dashboard/dimou'
│          │     │     └── gimou/
│          │     │           ├── components/ # 私有复用组件
│          │     │           ├── page.css
│          │     │           └── page.tsx # => '/dashboard/gimou'
│          │     └── [question]/
│          │           ├── components/ # 私有复用组件
│          │           ├── page.css
│          │           └── page.js # => '/dashboard/[question]/'
│          ├── favicon.ico # 标签页处图标
│          ├── globals.css
│          ├── layout.tsx
│          ├── robot.txt # 告知搜索引擎爬虫能否访问特定的页面, 以及站点地图的地址
│          ├── page.css
│          └── page.tsx # => '/'
├── public/ # 默认存放静态资源的目录
│    └── assets/ # 本项目自定义的静态文件目录(图片、视频、音频)
│          └── logo.png # 网站项目 logo
...
```

> 补充：如果希望使用目录来组织文件，而不是变成路由，则可以使用 `(xxx)` 创建一个路由组，底下的文件夹如果包含 `page` 文件，就不会把路由组也当作路由的一部分。
>
> 另外 `Next.js` 还支持使用 `[xxx]` 动态路由，也就是不同参数的 `URL` 复用大致相同的路径。
>

> 补充：相关支持连接。
>
> - [Next.js 官方文档](https://nextjs.org/docs/getting-started/installation)
> - [切换管理 node 版本的工具](https://github.com/nvm-sh/nvm)
> - [初始化项目](https://nextjs.org/docs/getting-started/installation#automatic-installation)
> - [整合工具指引](https://nextjs.org/docs/app/building-your-application/configuring/eslint#prettier)
> - [框架组件引入文档](https://ant-design.antgroup.com/docs/react/use-with-next-cn) 和 [组件拓展框架引入文档](https://ant-design.antgroup.com/docs/react/use-with-next-cn)
> - [Next.js 路由规则](https://nextjs.org/docs/app/building-your-application/routing)
> - [Next.js 静态资源](https://nextjs.org/docs/app/building-your-application/optimizing/static-assets)
> - [Next.js 特定目录](https://nextjs.org/docs/app/api-reference/file-conventions/metadata)
> - 待补充...

## 4.5.设置页面路由管理



## 4.6.设置应用初始管理



## 4.7.设置全局状态管理



## 4.8.设置页面权限管理



## 4.9.设置页面显示管理



## 4.10.设置其他配置管理

编辑器插件、表格插件、代码高亮插件...

# 5.目录结构

```shell
# 目录结构
$ tree -L 2 -a /intelligent-interview-frontend
.
├── assets/ # [项目文档资源目录]
├── README.md # 项目文档说明
│
├── config/ # [自定义配置文件目录]
│    └── menus.tsx # 页面路由配置
│
├── public/ # [默认存放静态资源的目录]
│    ├── assets/ # [本项目自定义的静态文件目录(图片、视频、音频)]
│    │     └── image/ # [图片资源目录]
│    └── logo.png # 网站项目 logo
│
├── openapi.config.ts # openapi 配置文件
│
├── src/ # [默认存放项目代码的目录]
│     ├── lib/ # [第三方库目录]
│     ├── access/ # [权限管理目录]
│     ├── stores/ # [状态仓库目录]
│     ├── api/ # [自动生存接口目录]
│     ├── components/ # [公共复用组件目录]
│     │    └── MyComponents/ # [公共组件目录]
│     │          ├── page.css
│     │          └── index.tsx
│     ├── layouts/ # [公共布局组件]
│     │    └── MyLayout/ # [公共布局目录]
│     │          ├── page.css
│     │          └── index.tsx
│     └── app/ # [前端主体应用]
│          ├── my-app/ # [路由目录]
│          │     ├── components/ # 私有复用组件
│          │     ├── page.js # => '/my-app'
│          │     ├── my-app-app/
│          │     │     ├── components/ # 私有复用组件
│          │     │     ├── page.css
│          │     │     └── page.tsx # => '/my-app/my-app-app'
│          │     ├── (blog)/ # [页面组织目录]
│          │     │     ├── limou/
│          │     │     │     ├── components/ # [私有复用组件]
│          │     │     │     ├── page.css
│          │     │     │     └── page.tsx # => '/my-app/limou'
│          │     │     ├── dimou/
│          │     │     │     ├── components/ # [私有复用组件]
│          │     │     │     ├── page.css
│          │     │     │     └── page.tsx # => '/my-app/dimou'
│          │     │     └── gimou/
│          │     │           ├── components/ # [私有复用组件]
│          │     │           ├── page.css
│          │     │           └── page.tsx # => '/my-app/gimou'
│          │     └── [question]/ # [路径复用目录]
│          │           ├── components/ # 私有复用组件
│          │           ├── page.css
│          │           └── page.js # => '/my-app/[question]/'
│          ├── favicon.ico # 标签页处图标
│          ├── forbidden.tsx # 禁止进入页面
│          ├── globals.css # 全局样式文件
│          ├── layout.tsx # 全局布局文件
│          ├── robot.txt # 爬虫策略文件
│          ├── page.css # 页面样式文件
│          └── page.tsx # => '/'
...

```

# 6.编码规范

结合上述的目录规定，这里给出开发准则。

1. 存放静态资源后，最好使用官方特定的组件渲染，例如 ``<Image src={`/assets/log.png`} alt={alt} width="64" height="64" />``，这样静态资源在渲染的时候就可以得到官方的优化。不过也存在某些静态文件不建议放在 `public/` 中的情况（例如网站标签图标 `favicon.ico` 官方建议放在 `app/` 下）。另外，需要注意 `src` 自动会寻找 `public` 作为根目录

2. 这里我们规定除去官方的默认页面，新的开发都是需要新建目录开始，然后在内部放入 `page` 和 `index.css`

3. 而如果需要共用组件，则需要在和 `app/` 同级的目录 `components/` 中进行开发，页面私有组件就在页面目录中开发

4. 每个页面目录下都必须包含三个部分 `page.tsx, page.css, components/`

5. `React` 开发只允许使用函数式声明，降低理解难度和编写难度。

6. 无论是页面文件还是组件文件，都需要爱明确是服务端渲染还是客户端渲染。

7. 一个标准的页面文件 `.../my-page/page.tsx` 的内容如下。
    ```tsx
    // .../my-page/page.tsx
    /* 渲染方式 */
    "use client"; // 注释本行则默认服务端渲染
    
    /* 引入样式 */
    import "./page.css";
    
    /* 引入组件 */
    // import ...
    
    /* 定义属性 */
    // interface ...
    
    /* 组织页面 */
    /**
     * ...(主代码)
     */
    export default function MyPage() {
      // 返回页面
      return (
        <main id="myPage">
          <>
            各种组件...
          </>
        </main>
      );
    }
    
    ```

8. 一个标准的组件文件 `.../components/MyComponent/index.tsx` 的内容如下。

    ```tsx
    // .../components/MyComponent/index.tsx
    /* 渲染方式 */
    "use client"; // 注释本行则默认服务端渲染
    
    /* 引入样式 */
    import "./page.css";
    
    /* 引入组件 */
    // import ...
    
    /* 定义属性 */
    // interface ...
    
    /* 组织组件 */
    /**
     * ...(主代码)
     */
    const MyComponent = (props: Props) => {
      // 获取属性
      const { value1 = "" } = props; // 使用解析语法解析属性内部的字段
      const { value2 = "" } = props;
      const { value3 = "" } = props;
    
      // 返回页面
      return (
        <className="my-component">
            各种组件...
        </>
      );
    }
    
    export default MyComponent;
    ```

9. 一个标准的布局文件 `.../layouts/MyLayouts/index.tsx`

    ```tsx
    // .../layouts/MyLayouts/index.tsx
    // 渲染方式
    "use client"; // 注释本行则默认服务端渲染
    
    // 引入组件
    import "..."
    
    /* 引入组件 */
    // import ...
    
    /* 定义属性 */
    // interface ...
    
    /* 组织布局 */
    /**
     * ...(主代码)
     */
    const MyLayouts = (props: Props) => { // 大驼峰
      // 获取属性
      const { value1 = "" } = props; // 使用解析语法解析属性内部的字段
      const { value2 = "" } = props;
      const { value3 = "" } = props;
    
      // 返回页面
      return (
        <className="my-layouts">
            各种组件...
        </>
      );
    }
    
    export default MyLayouts;
    
    ```

10. 开发时定期打包构建，严格注意 `TS` 类型和编辑器的错误提示

11. 谨慎使用 `win~dows` 浏览器环境对象，确保服务端渲染和页面渲染的一致性，否则就会出现水合错误（默认 `Next.js` 中是服务端渲染）

12. 使用 `prettier` 代码格式化工具，自动调整代码的格式，提升代码的可读性。编写项目的时候需要使用 `WebStorm` 的保存时运行即可进行规范化。

> 补充：在自然界中，“水合”指的是水分子与其他分子的结合，而在前端中，水合过程类似于将客户端的 `JavaScript` 逻辑“浇灌”到已有的静态 `HTML` 上，使其充满“活力”。因此，如果在这个过程中出现问题，就称为“水合错误”。 

# 7.功能拓展



